%#!platex ./report.tex

%
% 全体的な小節のたてかたが甘い
% 内容を書く順番を考えた方がいい

%親の枝という定義がわかりにくい

\chapter{研究手法・原理}
 \section{手法の概要}
 本研究の手法の概略は, まず単一の神経細胞が持ちうる機能をあらかじめ設定し, 
 その機能をうまく実現する神経細胞形態とコンダクタンスの分布を遺伝的アルゴリズム
 を用いて探索するというものである\cite{torben2009systematic}. 
 神経細胞の形態生成には確率的な手法を用い,その際に用いる確率パラメータを
 遺伝的アルゴリズムの遺伝子として扱う. 

 \section{神経細胞の機能}
 本研究で神経細胞に設定する機能は, 樹状突起上の異なる2つの部位にある時間
 差${\Delta}t[{\rm ms}]$をもって入力刺激を与えた場合, 入力の順序によって細胞体での
 脱分極量が変化する機能(input-order detection)である. より具体的には
 次のような機能である. \\
 ある神経細胞が空間状に分離した2つのシナプティックゾーンに樹状突起を伸ばし, それぞれの
 シナプティックゾーン中にいくつかのシナプスを形成しているとする. 仮にこ
 の二つのシナプティックゾーンをシナプティックゾーンA, シナプティックゾー
 ンBとする. シナプティックゾーンAに形成されたシナプス群をシナプスグルー
 プA, シナプティックゾーンBについても同様にシナプスグループBがあるとする.
 この神経細胞において一方のシナプスグループの全てのシナプスが時刻$t$で活性化
 し, その${\Delta}t[{\rm ms}]$後に他方のシナプスグループの全てのシナプスが活性化す
 るとする. その際に細胞体で観測される最大の脱分極量を$R$とする. シナプスグループAの
 シナプスが時刻$t$に活性化する場合の$R$を$R_{A{\to}B}$とし, シナプスグループBのシナプスが
 時刻$t$に活性化する場合の$R$を$R_{B{\to}A}$とする. このときinput-order detectionの
 機能性($F$)は以下の式によって定量的に評価することができる. 

 \begin{equation}
  F = \frac{R_{A{\to}B}}{R_{B{\to}A}}
   \label{F}
 \end{equation}

 以下の図\ref{Neuron}に神経細胞と, シナプティックゾーンを例示する. 
 また本研究では大きい$F$の値を示す神経細胞について, 機能性の高い神経細胞であると定義する. 
 input-order detectionについての概念図を以下の図\ref{input-order_detection}に示す.
 \begin{figure}[h]
   \centering
   \begin{minipage}{0.4\columnwidth}
     \includegraphics[width=\columnwidth]{./Images/temp.png} 
     \caption{神経細胞の例}
     \label{Neuron}
   \end{minipage}
   \begin{minipage}{0.4\columnwidth}
     \centering
     \includegraphics[width=\columnwidth]{./Images/temp.png} 
     \caption{input-order detection}
     \label{input-order_detection}
   \end{minipage}
 \end{figure}

 \section{神経細胞形態の作成方法}
   簡単のため神経細胞の形態は細胞体と2本の樹状突起のみからなるとする.
   また細胞体の形態は常に一定の大きさの球形であるとする. 
   よって神経細胞の形態生成は樹状突起の形態を生成することで行われる.
   樹状突起形態の生成は確率的な手法を用いる. また樹状突起上のコンダクタンス分布の決定には
   線形分布とガウス分布の2つの手法をそれぞれ使用した. 
   \subsection{神経細胞形態の表現}
     神経細胞の形態を3次元空間上に表現する. 細胞体は直径25$[{\rm{{\mu}m}}]$の
     球とし, 樹状突起は円柱の集合体として表現する. 円柱端部の中心部分
     は他の円柱や細胞体と結合し樹状の構造を形成する. ここで, 細胞体に直接結合
     している円柱をStem, それ以外の円柱をBranchとする. また1つのStemと, 
     その後ろに結合している, Branchからなる樹状構造をあわせて1つの樹状突起
     であると定義する. よって1つの神経細胞はStemの本数だけの, 複数の樹状突起を持つ.
     この神経細胞形態に関する定義を以下の図\ref{morpho}に示す.
     \begin{figure}[h]
       \centering
       \includegraphics[width=5cm]{./Images/temp.png} 
       \caption{神経細胞形態に関する定義}
       \label{morpho}
     \end{figure}
     \subsection{樹状突起形態生成手法の基本概念}
     樹状突起形態生成手法の基本はL-system\cite{prusinkiewicz1990}である. 
     L-systemはある記号の集合とその置き換え規則から定義され, 初期状態としてある記号列が与え
     られると, それを再起的に変更していくシステムである. L-systemの例
     \cite{torben2007evolving}を示す. まず記号の集合$\{B,F,X,Y\}$定義す
     る. 次にその置き換え規則として
     \begin{align*}
       rules: \hspace{0.2cm} & F \to YF\\
       & X \to BX
     \end{align*}
     を定義する. 初期状態として記号列$FX$が与えられたとすると,
     L-systemは置き換え規則に従ってこの記号列の置き換えを再起的に行う. 2回
     目の置き換え終了までの記号列の変化は以下のようになる.
     \begin{align*}
       initial:\hspace{0.2cm} & FX \\
       1^{st} cycle:\hspace{0.2cm} & YFBX \\
       2^{nd} cycel:\hspace{0.2cm} & YYFBBX
     \end{align*}
     樹状突起形態の生成方法として, 三宮 et al\cite{三宮信夫1998遺伝
       アルゴリズムと最適化}を参考にすると以下のようなL-systemが考えられる.
     使用する記号の集合として$\{1,2,3\}$を定義する.置き換え規則として
     \begin{align*}
       rules: \hspace{0.2cm}
       & 1 \to
       \begin{cases}
         3 & \text{if-Termination}\\
         \begin{cases}
           21<21> &\text{if-Bifurcation} \tag{$*$}\\
           21 &\text{else}
         \end{cases} & \text{else}
       \end{cases}\\
       & 2 \to 2
       & 3 \to 3
     \end{align*}
     を定義する. 記号1,2,3を樹状突起の構造に置き換えると, 記号1は樹状
     構造における未成長の点を表し, 記号2は成長済みの円柱構造, 記号3は枝の終端点に対応する.
     また, $<$\hspace{0.1cm}$>$は樹状構造の分岐を表す. すなわちこのL-Systemは
     初期状態のある一点から, 樹状構造が生成されていく過程を表現する. 
     記号$1$の置き換え規則($*$)は決定的ではなく, 後に述べる分岐確率や終端確率によって決定
     される. 1つの樹状突起は初期状態$\{1\}$から, このL-Systemを開始し記号列が変
     化しなくなるまで置き換えを行うことで得られる.\\
     最終的に得られる記号列は記号2と記号3からなり, 最も左端にある記号2がStemを表し,
     それ以外の記号2はBranchを表す. 
     記号1から記号2が生成される場合には, 以下の手法を用いて新たなStemやBranchが生成される. 

   \subsection{パラメータセットからのStem, Branch生成}
     1つの樹状突起は1組のパラメータセットから作成される. よって1つの神経細胞は2組の
     パラメータセットを持ち, そこから2本の樹状突起が生成される.
     パラメータセットに含まれるパラメータを以下に示す.
     表\ref{morpho_parameter}は樹状突起形態を生成するために使用するパラメータである. 

     \begin{table}[H]
       \caption{形態パラメータ}
       \label{morpho_parameter}
       \begin{center}
         \begin{tabular}[H]{|c|c|} \hline
           パラメータ名 & 説明 \\ \hline \hline
           \textit{Segment Length} [${\rm {\mu}m}$]& StemおよびBranchの長さ \\ \hline
           \textit{Stem diameter}  [${\rm {\mu}m}$]& Stemの直径 \\ \hline
           \textit{Stem elevation MIEW} [$^{\circ}$]& Stemの仰角決定に用いる平均値 \\ \hline
           \textit{Stem elevation SIGMA} [$^{\circ}$] & Stemの仰角決定に用いる標準偏差値  \\ \hline
           \textit{Stem rotation MIEW}  [$^{\circ}$]& Stemの回転角決定に用いる平均値 \\ \hline
           \textit{Stem rotation SIGMA} [$^{\circ}$]& Stemの回転角決定に用いる標準偏差値 \\ \hline
           \textit{Branch elevation MIEW} [$^{\circ}$]& Branchの仰角決定に用いる平均値 \\ \hline
           \textit{Branch elevation SIGMA} [$^{\circ}$] & Branchの仰角決定に用いる標準偏差値 \\ \hline
           \textit{Branch rotation MIEW}  [$^{\circ}$]& Branchの回転角決定に用いる平均値 \\ \hline
           \textit{Branch rotation SIGMA} [$^{\circ}$] & Branchの回転角決定に用いる標準偏差値  \\ \hline
           \textit{Bifurcation} $\alpha$ & 樹状構造の分岐導入判定に用いる$k$値 \\ \hline
           \textit{Bifurcation} $\beta$  & 樹状構造の分岐導入判定に用いる$\theta$値 \\ \hline
           \textit{Termination} $\alpha$ & 樹状構造の終端点導入判定に用いる$k$値 \\ \hline
           \textit{Termination} $\beta$  & 樹状構造の終端点導入判定に用いる$\theta$値\\ \hline
         \end{tabular}
       \end{center}
     \end{table}

     上記の形態パラメータに加え, 樹状突起上のコンダクタンスを線形に分布させる場合は表\ref{liner_parameter}に示される
     パラメータを, ガウス分布に従って分布させる場合には表\ref{gausian_parameter}に示されるパラメータをそれぞれ用いる.

     \begin{table}[H]
       \caption{線形分布コンダクタンス パラメータ}
       \label{liner_parameter}
       \begin{center}
         \begin{tabular}[H]{|c|c|} \hline
           パラメータ名 & 説明 \\ \hline \hline
           Ka \textit{Stem conductance} [${\rm S/cm^2}$]& StemのKaコンダクタンス値 \\ \hline
           Ka \textit{taper rate}  & Kaコンダクタンスの伝搬率 \\ \hline
           CaT \textit{Stem conductance} [${\rm S/cm^2}$]& StemのCaTコンダクタンス値 \\ \hline
           CaT \textit{taper rate}  & CaTコンダクタンスの伝搬率 \\ \hline
         \end{tabular}
       \end{center}
     \end{table}

     \begin{table}[H]
       \caption{ガウス分布コンダクタンス パラメータ}
       \label{gausian_parameter}
       \begin{center}
         \begin{tabular}[H]{|c|c|} \hline
           パラメータ名 & 説明 \\ \hline \hline
           Ka \textit{peak} [${\rm S/cm^2}$]&  Kaコンダクタンス分布の最大値\\ \hline
           Ka \textit{Gausian MEAN} & Kaコンダクタンス分布が従うガウス分布の平均値 \\ \hline
           Ka \textit{Gausian SIGMA} & Kaコンダクタンス分布が従うガウス分布の標準偏差値 \\ \hline
           CaT \textit{peak} [${\rm S/cm^2}$]&  CaTコンダクタンス分布の最大値\\ \hline
           CaT \textit{Gausian MEAN} & CaTコンダクタンス分布が従うガウス分布の平均値 \\ \hline
           CaT \textit{Gausian SIGMA} & CaTコンダクタンス分布が従うガウス分布の標準偏差値 \\ \hline
         \end{tabular}
       \end{center}
     \end{table}

   以下にStem, Branchの形態決定方法を述べる. Stem, Branchの形態の決定は以下の長さ, 太さ, 仰角, 回転角
   の4つを決定することで行う. 

   \begin{itemize}
    \item \textbf{長さの決定}\\
      Stem, Branchの長さはパラメータセットにある
      \textit{Segment Length}の値そのものである. 
    \item \textbf{太さの決定}\\
      Stem, Branchで決定方法が異なり, \\
      \begin{tabular}[c]{ll}
        - Stemの場合: & \textit{Stem diameter} \\
        - Branchの場合: & $diam_P \times taper\hspace{0.1cm}rate$ \\
      \end{tabular} \\
      ここで$diam_P$はそのBranchの親枝となるStemまたはBranchの太さであり, % <- 親枝っていうのか？
      $taper\hspace{0.1cm}rate = 0.875$となる定数である. 
    \item \textbf{仰角の決定}\\
      Stem, Branchの仰角は正規分布から確率的に決定する. 使用するパラ
      メータはStem, Branchで異なり, \\
      \begin{tabular}[c]{lll}
        - Stemの場合: & $\mu = $\textit{Stem elevation MIEW} & $\sigma = $\textit{Stem elevation SIGMA} \\
        - Branchの場合: & $\mu = $\textit{Branch elevation MIEW} & $\sigma = $\textit{Branch elevation SIGMA} \\
      \end{tabular}
    \item \textbf{回転角の決定}\\
      仰角の場合と同様に正規分布から確率的に決定し, \\
      \begin{tabular}[c]{lll}
        - Stemの場合: & $\mu = $\textit{Stem rotation MIEW} & $\sigma = $\textit{Stem rotation SIGMA} \\
        - Branchの場合: & $\mu = $\textit{Branch rotation MIEW} & $\sigma = $\textit{Branch rotation SIGMA} \\
      \end{tabular}
   \end{itemize}

   \subsubsection{仰角, 回転角について}
   Stem, Branchの角度の設定には, 親となるStem, Branchの向きにあわせた相
   対的な座標軸を用いる. 具体的には以下のようにする. 
   \begin{itemize}
    \item \textbf{Stemの角度設定}
	  \begin{enumerate}
	   \item 仰角の設定 \\
		 仰角を$elevation^{\circ}$とする. まず, Stemは3次元空間
		 の原点からx軸と同じ方向に伸びているとする. ここからz軸
		 を中心として右ねじの方向に$elevation^{\circ}$回転させる.
		 この際y軸, x軸も同様に回転を行い, それぞれy'軸, z'軸と
		 する.
	   \item 回転角 \\
		 次に, 回転角を$rotation^{\circ}$とする. 仰角と同様に,
		 y'軸の右ねじの向きに$rotation^{\circ}$回転させる. また,
		 x'軸, z軸についても同様の回転を行い, それぞれx''軸, z'
		 軸とする.
	  \end{enumerate}
    \item \textbf{Branchの角度設定} \\
	  Stemと同様に行う. ただし, そのBranchの親となるStem, Branchによっ
	  て回転を与えたx'',y',z'軸を用いる. 
   \end{itemize}

   形態生成L-systemにおける記号$2$はStemやBranchなどの形態情報に対応している. 
   初期状態の記号$1$の座標を原点$(0,0,0)$とすると, 全ての記号$1$に3次元空間上の
   座標情報を設定することができる. 原点から, ある記号$1_i$に至
   るまでに通過するStemやBranchの長さの和を${\rm path(1_i)}$とする. ここで記号
   $1$の置き換え規則($*$)の選択方法を以下に示す.
   \begin{enumerate}
     \item \textbf{Termination $ 1 \to 3$} \\
       $[0,1]$の範囲で一様分布に従う乱数を一つ生成し, その値を$rand$とする.
       累積ガンマ分布\textit{Cumulative} $\gamma$(x)を用いて, 
       \begin{equation}
	 {\rm Cumulative}\hspace{0.1cm}\gamma\hspace{0.05cm}({\rm path(1_i)}) > rand
       \end{equation}
       のとき伸張停止とする. ただし累積ガンマ分布のパラメータとして, \\
       \begin{tabular}[c]{ll}
         - \textit{k} : & \textit{Termination} $\alpha$ \\
         - $\theta$ : &  \textit{Termination} $\beta$\\
       \end{tabular}\\
       を用いる.
     \item \textbf{Bifurcation $ 1 \to 21<21>$} \\
       Terminationを行わなかった場合のみBifurcationの判断を行う. 
       $[0,1]$の範囲で一様分布から乱数を一つ生成し, その値を$rand$とする.
       最大値が0.8になるように実数倍したガンマ分布
       \textit{Scaled} $\gamma$(x)を用いて,
       \begin{equation}
	 Scaled\hspace{0.1cm}\gamma\hspace{0.05cm}(path(1_i)) > rand
       \end{equation}
       のとき分岐を行う. ただしガンマ分布のパラメータとして, \\
       \begin{tabular}[c]{ll}
         - \textit{k} : & \textit{Bifurcation} $\alpha$ \\
         - $\theta$ : &  \textit{Bifurcation} $\beta$\\
       \end{tabular}\\
       を用いる

     \item \textbf{Elongation $1 \to 21$} \\
       上記の条件を満たさなかった場合, Stem, Branchを伸張させる.
   \end{enumerate}

   ただし, 以下の条件に該当する場合は強制的にTerminationとする. これは樹
   状突起として妥当な形態を得るために導入するヒューリスティックスである.    % <- 妥当とは?

   \begin{itemize}
    \item ${\rm path(1_i)} > 2000$のとき
    \item $diam_P <= Minimum diameter$ のとき\\
	  また, この場合は$diam_P$をMinimum diameterに設定し直す. 
   \end{itemize}

   最終的に得られた樹状突起形態は細胞体の表面に接するように, Stemの方向
   に平行移動させる. \\   
   以下にStem, Branchのコンダクタンス値の決定方法を述べる. コンダクタンス値の決定方法は
   線形分布を用いるかガウス分布を用いるかによって異なる. 

   \begin{itemize}
     \item \textbf{線形分布の場合}\\
       CaT, Kaコンダクタンス値について, 上記のdiameterと同様の方法で決定する\\
      \begin{tabular}[c]{ll}
        - Stemの場合: & \textit{Stem conductance} \\
        - Branchの場合: & $Conductance_{P} \times$ \textit{Conductance taper rate} \\
      \end{tabular} \\
       ここで$Conductance_{P}$はそのBranchの親枝となるBranchやStemのコンダクタンス値である.
     \item \textbf{ガウス分布の場合}\\
       CaT, Kaコンダクタンス値について, 以下の方法で決定する. \\
%
% 5μごとに分割してコンダクタンスを設定する, と書く
%
%
   \end{itemize}

   \subsection{シナプティックゾーンとシナプスの付与}
     3次元空間上の原点に細胞体を配置し, y軸方向の$170 < y < 190$の範囲を % <- この辺の座標情報を変数にしたほうがいいかも
     Redシナプティックゾーン, y軸方向の$-170 > y > -190$の範囲をBlueシナプティック
     ゾーンと定義する. シナプティックゾーン内に樹状突起が形成された
     場合, 樹状突起の$5{\mu}m$ごとに1つのシナプスを付与する. % <- 5マイクロm ってどういう向きの？
     二つのシナプティックゾーンにシナプスが付与された樹状突起の例を図\ref{synapse}に示す.
     \begin{figure}[h]
       \centering
       \includegraphics[width=5cm]{./Images/temp.png} 
       \caption{シナプティックゾーン, シナプス}
       \label{synapse}
     \end{figure}
      
 \section{シミュレーション}
   前項の神経細胞形態によって作成した神経細胞に対して, 機能性を検証するた
   めの数理シミュレーションを行った. このシミュレーションにはNEURONシミュ
   レータを用いた. 以下にシミュレーションに用いた神経細胞モデルの詳細を述
   べる
   \subsection{数理モデル}
     L-systemによって作成された神経細胞形態は数理シミュレーションを行う
     ために$5{\mu}m$ごとに1つのコンパートメントとして, その膜電位の挙動を
     数理モデル化した. 神経細胞全体ではマルチコンパートモデルを形成してい
     る. コンパートメントの膜上にシナプスや, 特定のイオンチャネルが分布し
     ていない場合, 単一コンパートメントの膜電位($V_i$)は以下の式によって計算
     される.

     %g_leakは平衡電位 = -70になるように調節している
     \begin{equation}
       cm\frac{dV_i}{dt} = g_{leak}(V_i - E_{leak}) + g_{i,i - 1}(V_{i - 1}
       %このcmは小文字か大文字か?
       %
       %ここにあらかじめ I_CaTとI_Kaをおいた方がいい
       - V_i) + g_{i,i + 1}(V_{i + 1} - V_i)
       \label{V_i}
     \end{equation}
     コンパートメントの膜上にシナプスが分布している場合は上式\ref{V_i}の右
     辺に以下の項を追加する.
     \begin{equation}
       (e^{-\frac{t}{{\tau}2}} - e^{-\frac{t}{{\tau}1}})g_{syn}(V_i
       - E_{syn})
       \label{eq_syn}
     \end{equation}

     細胞膜上にKaチャネル, CaTチャネルを分布させる場合は, \ref{V_i}の右辺に
     Migliore et al\cite{migliore1995computer}に示されるイオンチャネルの
     モデルを追加した. 
     \begin{itemize}
       \item 電位依存型T型${\rm Ca^{2+}}$電流
         \begin{align}
           I_{CaT} &= g_{CaT} {\cdot} ghk(V_{i},cai,cao) \\                    %V_iとVが混在してるけど、統一した方がよいと思われる
           g_{CaT} &= \overline{g}_{CaT} {\cdot} m^2 {\cdot} h  \\
           KTF &= \left(\frac{25.0}{293.15}\right) {\cdot} (T + 273.15) \\
           f &= \frac{KTF}{2} \\
           nu &= \frac{V_i}{f} \\
           ghk &= -f {\cdot} \left(1.0 - \frac{C_i}{C_o} {\cdot} \exp(nu) \right) {\cdot} efun(nu) \\
           efun(z) &=
           \begin{cases}
             1 - \frac{z}{2} & \text{$|z| < 10^{-4}$} \\
             \frac{z}{(e^z - 1)} & \text{Other} \\
           \end{cases}
         \end{align}

         また, CaTコンダクタンスのゲート変数($m$および$h$)の挙動は以下の微分方程式によって表現される.
         
         \begin{align}
           {\tau}_{m}(V_i)\frac{dm}{dt} &= \frac{{\alpha}_m(V_i)}{{\alpha}_m(V_i) + {\beta}_m(V_i)} - m \\
           {\tau}_m(V) &= \frac{1}{{\alpha}_m(V) + {\beta}_m(V)} \\
           {\alpha}_m(V) &= 0.2{\cdot}\frac{-V + 19.26}{\exp(\frac{-V + 19.26}{10}) - 1} \\
           {\beta}_m(V) &= 0.009{\cdot}\exp(-\frac{V}{22.03})
         \end{align}

         \begin{align}
           {\tau}_{h}(V_i)\frac{dh}{dt} &= \frac{{\alpha}_h(V_i)}{{\alpha}_h(V_i) + {\beta}_h(V_i)} - h\\
           {\tau}_{h}(V) &= \frac{1}{{\alpha}_h(V) + {\beta}_h(V)} \\
           {\alpha}_h(V) &= 10^{-6}{\cdot}\exp(-\frac{V}{16.26}) \\
           {\beta}_h(V) &= \frac{1}{\exp(\frac{-V + 29.79}{10}) + 1}
         \end{align}

       \item A型K$^+$電流
         \begin{align}
           I_{Ka} &= g_{Ka}{\cdot}(V_i - E_{Ka}) \\
           g_{Ka} &= \overline{g}_{Ka}{\cdot}n{\cdot}l
         \end{align}
         また, Kaコンダクタンスのゲート変数($n$および$l$)の挙動は以下の微分方程式によって表現される.
         \begin{align}
           {\tau}_n(V)\frac{dn}{dt} &= \frac{1}{1 + {\alpha}_n(V)} - n \\
           {\tau}_n(V) &= \frac{{\beta}_n(V)}{Q_{10}{\cdot}{\alpha}_{0n}{\cdot}(1 + {\alpha}_n(V))} \\
           {\alpha}_n(V) &= {\exp}\left(\frac{10^{-3}{\cdot}{\zeta}_n{\cdot}(V - V_{n\frac{1}{2}}){\cdot}9.648{\cdot}10^4}
                                             {8.315{\cdot}(273.16 + T)} \right) \\
           {\beta}_n(V) &= {\exp}\left(\frac{10^{-3}{\cdot}{\zeta}_n{\cdot}gmn{\cdot}(V - V_{n\frac{1}{2}}){\cdot}9.648{\cdot}10^4}
                                             {8.315{\cdot}(273.16 + T)} \right) \\
         \end{align}

         \begin{align}
           {\tau}_l(V)\frac{dl}{dt} &= \frac{1}{1 + {\alpha}_l(V)} - l \\
           {\tau}_l(V) &= \frac{{\beta}_l(V)}{Q_{10}{\cdot}{\alpha}_{0l}{\cdot}(1 + {\alpha}_l(V))} \\
           {\alpha}_l(V) &= {\exp}\left(\frac{10^{-3}{\cdot}{\zeta}_l{\cdot}(V - V_{l\frac{1}{2}}){\cdot}9.648{\cdot}10^4}
                                             {8.315{\cdot}(273.16 + T)} \right) \\
           {\beta}_l(V) &= {\exp}\left(\frac{10^{-3}{\cdot}{\zeta}_l{\cdot}gml{\cdot}(V - V_{l\frac{1}{2}}){\cdot}9.648{\cdot}10^4}
                                             {8.315{\cdot}(273.16 + T)} \right) \\
         \end{align}
     \end{itemize}

     ただし
     \begin{align}
       Q_{10} &= 3^{(\frac{T - 30}{10})}
     \end{align}
     である.
%
% gmn gmlは何なのか？ g_{mn}なのか？ 単位は無いようなので、gmnだと思う
%
     また, シミュレーションに関わるパラメータを以下の表\ref{sim_para}に示す.

     \begin{table}[H]
       \caption{シミュレーションパラメータ}
       \label{sim_para}
       \begin{center}
	\begin{tabular}[t]{|c|c|} \hline
	 パラメータ名 & 値 \\ \hline \hline
	 Simulation time [ms]& 50 または 100 \\\hline % <- ここ変える 2段組みの表にする
	 $Ra$  [${\rm{\Omega}cm}$] & 100 \\ \hline
	 $Cm$  [${\rm{\mu}F/cm^2}$] & 0.8 \\ \hline
	 ${\tau}_{1}$ [ms] & 0.5\\ \hline
	 ${\tau}_{2}$ [ms] & 2\\ \hline
	 $V_{init}$ [mV]& -70\\ \hline
	 $g_{pas}$ [${\rm S/cm^2}$]& $2.5 \times 10^{-5}$\\ \hline
	 $E_{pas}$ [mV] & -70\\ \hline
	 $E_{Ka}$ [mV] & -91\\ \hline
	 $T$ [${\rm ^{\circ}C}$] & 37\\ \hline
         $\overline{g}_{CaT}$ [${\rm S/cm^2}$]& 0.003\\ \hline
         $\overline{g}_{Ka}$ [${\rm S/cm^2}$]& 0.01\\ \hline
         ${\alpha}_{0n}$ [${\rm ms^{-1}}$]& 0.02\\ \hline
         ${\alpha}_{0l}$ [${\rm ms^{-1}}$]& 0.08\\ \hline
         ${\zeta}_n$ & -3\\ \hline
         ${\zeta}_l$ & 4\\ \hline
         $gmn$ & 0.6\\ \hline
         $gml$ & 1\\ \hline
         $V_{n\frac{1}{2}}$ [mV]& -33.6\\ \hline
         $V_{l\frac{1}{2}}$ [mV]& -83\\ \hline
         $C_i$ [mM]& $50{\times}10^{-6}$\\ \hline
         $C_o$ [mM]& 2\\ \hline
         $C_o$ [mM]& 2\\ \hline
	\end{tabular}
       \end{center}
      \end{table}
      シミュレーションはNEURONを用いて, CVodeアルゴリズムを用いて行った.
      CVodeアルゴリズムを用いる際のエラーは$10^{-5}$未満に設定した. 

 \section{遺伝アルゴリズム}    % <- 「遺伝アルゴリズム」という名前はどうなのか？
   2組のパラメータセットを1つの個体として200個体, 世代数500で遺伝アルゴリズムを用いたパラメー
   タ最適化を行った. 
   この遺伝アルゴリズムにおける遺伝子とは個体の持つパラメータセットである. 
   ここで, 2つのパラメータセットをパラメータセットAとパラメータセットBと名付け, 
   そこから生成される樹状突起をそれぞれ樹状突起Aと樹状突起Bとする. 
   本研究の遺伝アルゴリズムでは, エリート保存, 一点交叉, 突然変異の手法を用いた. 以下にその詳細を述べる. 
   \subsection{個体評価}
     上述の通り各神経細胞の形態を生成しシミュレーションを行い, その結果を  % <- シミュレーションという言い方は良くない F値テストとか具体的に
     もとに個体の評価を行う. 個体の評価には, 個体の機能性\ref{F}のほか個体
     の体積, 分布するコンダクタンスの量を考慮する. 
     しかし, 個体によっては上下のシナプティックゾーンに樹状突起を伸ばせず, 
     そもそもシミュレーションを行うことができないものが発生することもある.
     また神経細胞をより実物に近づけることと, 妥当なシミュレーションを行うことを % <- 妥当とは？
     目的としていくつかのヒューリスティックスを導入した.
     以下に個体の評価方法を述べる. \\

     % 主な評価を先に書いて, あとでヒューリスティックを書いた方が良さそう
     \begin{itemize}
       \item \textbf{形態的エラー}\\
         両方のシナプティックゾーンにシナプスを持たずシミュレーションを行えない個体の場合
         樹状突起Aの$y$座標の最大値をmax($y_A$), 樹状突起Bの$y$座標の最小値をmin($y_B$)とし
         評価値$E$を
         \begin{equation}
           E = -{\rm max}\left(170 - {\rm max}(y_A),0\right) + {\rm min}\left(-170 - {\rm min}(y_B),0\right) - 100
           \label{Morpho_E}
         \end{equation}
         とする. 

       \item シミュレーションを行った個体に関しては以下の評価式によって評価値$E$を与える. 
         \begin{align}
           Function Minus &= \frac{F_i}{F_{max}} \\
           Morphology Minus &= \frac{Volume_i}{Volume_{max}} \\
           Conductance Minus &= \frac{Conductance ratio_i}{Conductance_{max}} \\ %あとで詳しく書く
         \end{align}

         \begin{equation}
           E = 100 - Function Minus - Morphology Minus - Conductance Minus
         \end{equation}
     \end{itemize}

     また, 以下のヒューリスティックスに該当する個体は, 以下の式によって評価する. %上の式との関連は?
     \begin{itemize}
       \item \textbf{形態的ヒューリスティックス}\\
         以下の場合はシミュレーションを行わず, 式\ref{Morpho_E}によって評価値$E$を与えた. 
         \begin{itemize}
           \item 神経細胞全体でStemとBranchの個数が合計15未満の場合
           \item 神経細胞全体で樹状突起の分岐が一つもない場合
         \end{itemize}
       \item \textbf{シミュレーションヒューリスティックス}\\
         一方のシナプティックゾーンのみでの発火による細胞体での膜電位の脱分極が2mV以下の場合以下の場合は % <- わかりにくいので書き直す
         $\mu = -50$, $\sigma = 5$のガウス分布から乱数を1つ発生させ, その値を評価値$E$とした.
         \begin{equation}
           E = N(\mu = -50, \sigma = 5) % <- この書き方はあってるのか
         \end{equation}

         また, 神経細胞の膜状にKaチャネル, CaTチャネルを分布させた場合は以下の場合にも上式によって評価値を与える. 
         これは神経細胞での発火や, 膜電位の振動を % <- 細胞体での発火を抑制する意味は? ここコンダクタンスの時のみの考慮にしなくてもよさそう
         抑制するためである.
         \begin{itemize}
           \item 細胞体での脱分極量が25mVを超えた場合
	   \item シミュレーションの最後の5ステップで膜電位の上昇が起こっ
	     た場合
         \end{itemize}
     \end{itemize}

   よって評価値は100に近いほど良い評価である. % <- 評価値の分布について、層になることを図示するか？

   \begin{figure}[h]
     \centering
     \includegraphics[width=5cm]{./Images/temp.png} 
     \caption{評価値}
     \label{Estimate}
   \end{figure}

   \subsection{エリート保存}
     各世代において最大の評価値をとった個体の遺伝子はそのまま次世代に引き
     継がれる. 
   \subsection{一点交叉, 突然変異}
   %交叉、突然変異を起こす個体の数は中心極限定理的な考えで求められる
     次世代の個体は一点交叉または突然変異のどちらかの手法によって作成され
     る. 一点交叉は評価値上位$\mu$個の個体を親として, $\lambda$個の子個体 % <- 遺伝的アルゴリズムに関するパラメータも後で表にまとめる
     を生成する. この$\lambda$個の子個体は評価値下位$\lambda$個の個体と交
     換される. 突然変異は残りの$200 - \lambda$個の個体に対して適用される. 
     ここで$\mu = 10$である. 
     \begin{itemize}
       \item 一点交叉\\
         評価値上位の$\mu$個体から確率的に親を2個体選択する. 評価値i番目の
         個体が選択される可能性を$P_i$とすると,
         \begin{equation} % 選択確率を円グラフで図示するか？
	   P_i =  
	   \begin{cases}
	     (\frac{1}{2})^i & \text{$(i < \mu$)}\\
	     (\frac{1}{2})^{i - 1} & \text{$(i = \mu)$}
	   \end{cases}\\
         \end{equation}
         なお, 同じ個体が重複して選択されないようにした. \\
         選択された2つの親個体を$Parent_1$, $Parent_2$とする. 
         一点交叉は親のパラメータセットA同士, パラメータセットB同士で以下のようにして一点交叉を行う. %なぜABを分けるのかを書いた方がわかりやすい
         \begin{itemize}
           \item \textbf{交差点の決定} %passiveの場合はK,Caコンダクタンスに関する部分は交叉を行っても無意味だった
             パラメータセットの項目数を$N_{Param}$とする. このとき交差点\textit{Cross}は$[1,N_{Param}]$から
             一様な確率で整数を1つ返す関数randN(min,max)を用いて
             \begin{equation}
               Cross = randN(1,N_{Param})
             \end{equation}
             とする. 

           \item どちらが上に行くか決める
           \item 交叉させて新たなパラメータセットを作る
         \end{itemize}
       \item 突然変異\\
     \end{itemize}
