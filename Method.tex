%#!platex ./report.tex

%
% コンダクタンスについて、なぜCaT、Kaを用いるのかを書いておく
%

%
% 先行研究の評価手法をよく言及しているので、ここに書いておいたほうがいいかも
%

\chapter{研究手法・原理}
 \section{研究手法の概要}
   本研究の手法の概略は以下のようなものである.
   \begin{enumerate}
     \item 単一の神経細胞の機能を1つ決める
     \item その機能をうまく実現する神経細胞の形態とコンダクタンス分布を
       遺伝アルゴリズムを用いて探索する
   \end{enumerate}
   本研究の手法は主にTorben-Nielsen et al. を参考にしている.\cite{torben2009systematic}
   神経細胞の形態と機能の関係性を探るアプローチとして, 
   神経細胞の形態からその機能を推定するのではなく, 先に機能を設定しその機能を
   実現する形態を探すという手法である. 
 \section{神経細胞の機能}
   本研究で神経細胞に設定する機能は, 樹状突起上の異なる2つの部位にある時間
   差${\Delta}t[{\rm ms}]$をもって入力刺激を与えた場合, 入力の順序によって細胞体での
   脱分極量が変化する機能(input-order detection)である. より具体的には
   次のような機能である. \\
   ある神経細胞が空間上に分離した2つの領域に樹状突起を伸ばし, それぞれの
   領域中にいくつかのシナプスを形成しているとする. 仮にこ
   の2つの領域をBlueシナプティックゾーン, Redシナプティックゾー
   ンとする. Blueシナプティックゾーンに形成されたシナプスをBlueシナプス,
   Redシナプティックゾーンについても同様にRedシナプスとする. 
   この神経細胞において, 一方のシナプティックゾーンの全てのシナプスを時刻$t$で活性化
   させ, その${\Delta}t[{\rm ms}]$後に他方のシナプティックゾーンのシナプスを活性化させる.
   その際に細胞体で観測される最大の膜電位上昇量を$R$とする. Blueシナプスグループの
   シナプスが先に活性化する場合の$R$を$R_{B{\to}R}$とし, Redシナプスグループのシナプスが
   先に活性化する場合の$R$を$R_{R{\to}B}$とする. このときinput-order detectionの
   機能性($F$)は以下の式によって定量的に評価することができる. 

   \begin{equation}
     F = \frac{R_{B{\to}R}}{R_{R{\to}B}}
     \label{F}
   \end{equation}

   また本研究では大きい$F$の値を示す神経細胞について, 機能性の高い神経細胞であると定義する. 
   以下の図\ref{sample}に神経細胞と, シナプティックゾーンを例示する. 図\ref{Neuron}の
   上部にある赤い点はRedシナプス, 下部の青い点はBlueシナプスを表し, 中央の
   球は細胞体である.  図\ref{synaptic-zone}の中央の緑の点は細胞体であり,
   この図は神経細胞とシナプティックゾーンとの
   位置関係を図示している. 図\ref{input-order_detection}は図\ref{Neuron}に示される神経細胞に
   対し, ${\Delta}t = 15$[ms]としてシナプス入力を与えた際の細胞体での膜電位変動を示している. 
   図\ref{input-order_detection}の場合, $R_{B{\to}R} = 6.29$, $R_{R{\to}B} = 4.75$より
   $F = 1.32$である. 

   \begin{figure}
     \centering
     \begin{subfigure}{0.3\columnwidth}
       \centering
       \includegraphics[width=\columnwidth]{./Images_Method/pass_neuron.png} 
       % 背景は白の方が良さそう
       % rglの三次元画像はepsにしないほうがよい
       \caption{神経細胞の例}
       \label{Neuron}
     \end{subfigure}
     \begin{subfigure}{0.2\columnwidth}
       \centering
       \includegraphics[width=\columnwidth]{./Images_Method/synaptic_zone.png}
       \caption{シナプティックゾーン}
       \label{synaptic-zone}
     \end{subfigure}
     \begin{subfigure}{0.4\columnwidth}
       \centering
       \includegraphics[width=\columnwidth]{./Images_Method/input_order_detection.eps} 
       \caption{input-order detection}
       \label{input-order_detection}
     \end{subfigure}
     \caption{作成した神経細胞とinput-order detection}
     \label{sample}
   \end{figure}

   %
   % input-order detectionについて passiveの場合Fの最大値は2と思われると書いておく
%     \subsection{input-order detectionについて}
%  Passiveモデルを用いると, 膜特性が膜電位によって変化しないため細胞体での膜電位上昇は
   %  入力電流の単純な加算となる. つまりinput-order detectionの$F$値の最大値は2になると考えられる.

   %これは結果の方に書くべきか?
   
   %% \subsection{Kaコンダクタンス, CaTコンダクタンスの効果}
   %%   神経細胞にKaコンダクタンスを導入すると, 膜電位を下げる働きをする. input-order detection
   %%   では主にRedシナプグループからの入力がこの影響を受ける. つまりRedシナプスグループの
   %%   入力による細胞体での脱分極がより小さく, 減衰も早くなる.
   %%   CaTコンダクタンスを導入した場合は逆に膜電位を上昇させる働きをする. input-order detection
   %%   ではBlueシナプスグループがこの影響を受け, 細胞体での脱分極がより大きく減衰も遅くなる. 
   
 \section{神経細胞形態の作成方法}
   簡単のため神経細胞の形態は細胞体と2本の樹状突起からなるとする. すなわち,
   上下のシナプティックゾーンにのびる2本の樹状突起と, 入力を加算する細胞体である. 
   細胞体の形態は一定の大きさの球形であるとする. 
   よって神経細胞形態の作成とは樹状突起の形態を生成することである. 
   樹状突起形態の生成は確率的な手法を用いている. 
   \subsection{神経細胞形態の表現}
     神経細胞の形態を3次元空間上に表現する. 細胞体は直径25$[{\rm{{\mu}m}}]$の
     球とし, この球を$Soma$とする. 樹状突起は円柱の集合体として表現する. 円柱端部の中心部分
     は他の円柱や細胞体と結合し, 樹状の構造を形成する. ここで, 1本の円柱を$Branch$と定義する.
     また細胞体と直接結合している$Branch$を特にStemと呼ぶ. 
     1本のStemと, そのStemから伸びる$Branch$によって構成された樹状構造を
     1つの樹状突起(Dendrite)と定義する. 
     よって1つの神経細胞はStemの本数だけのDendriteを持つ.
     以上の神経細胞形態に関する定義を図\ref{morpho}に示す.
     \begin{figure}[H]
       \centering
       \includegraphics[width=10cm]{./Images_Method/neuron_morpho.eps}
       \caption{神経細胞形態に関する定義}
       \label{morpho}
     \end{figure}
   \subsection{樹状突起形態生成手法の基本概念}
     樹状突起形態生成手法の基本はL-systemである.\cite{prusinkiewicz1990}
     L-systemは, ある記号の集合とその置き換え規則から定義され, 初期状態としてある記号列が与え
     られるとその記号列を再起的に変換していくシステムである. L-systemの例
     を示す.\cite{torben2007evolving} まず記号の集合$\{B,F,X,Y\}$定義す
     る. 次にその置き換え規則として
     \begin{align*}
       rules: \hspace{0.2cm} & F \to YF\\
       & X \to BX
     \end{align*}
     を定義する. 初期状態として記号列$FX$が与えられたとすると,
     L-systemは置き換え規則に従ってこの記号列の置き換えを再起的に行う. 2回
     目の置き換え終了までの記号列の変化は以下のようになる.
     \begin{align*}
       initial:\hspace{0.2cm} & FX \\
       1^{st} cycle:\hspace{0.2cm} & YFBX \\
       2^{nd} cycel:\hspace{0.2cm} & YYFBBX
     \end{align*}
     樹状突起形態の生成方法として, 三宮 et al. を参考にすると以下のようなL-systemが考えられる.\cite{三宮信夫1998遺伝
       アルゴリズムと最適化}
     使用する記号の集合として$\{S,B,T\}$を定義する.置き換え規則として
     \begin{align*}
       rules: \hspace{0.2cm}
       & S \to
       \begin{cases}
         T & \text{(Termination)}\\
         \begin{cases}
           <BS><BS> &\text{(Bifurcation)} \tag{$*$}\\
           BS &\text{(otherwise)}
         \end{cases} & \text{(otherwise)}
       \end{cases}\\
       & B \to B \\
       & T \to T
     \end{align*}
     を定義する. このL-systemを形態生成L-systemと呼ぶ. 
     記号$S,B,T$を樹状突起の構造に置き換えると, 記号Sは樹状
     構造における未成長の点を表し, 記号Bは$Branch$, 記号Tは樹状突起の終端点に対応する.
     ここで, $<$\hspace{0.1cm}$>$は樹状構造の分岐を表している. よって,
     形態生成L-systemは1つの未成長点を初期状態とし, そこから樹状構造が生成されていく過程を表現している. 
     記号Sの置き換え規則($*$)は決定的ではなく, 後に述べる分岐確率や終端確率によって決定
     される. 1つの樹状突起は初期状態$\{S\}$から形態生成L-systemを開始し記号列が変
     化しなくなるまで置き換えを行うことで得られる. また, 最も最初の記号置き換えでは必ず$S \to BS$の
     置き換えが選択されるようにする. \\
     最終的に得られる記号列は記号$B$と記号$T$からなり, 最も左端にある記
     号$B$がStemを表す. 形態生成L-systemから一つの樹状突起が生成される過程を例示する. また
     図\ref{fig:sample_L-system}は例の$initial$, $3^{rd}cycle$, $finish$
     を樹状構造として例示したものである. ここで各記号の添字は幅優先的につけられていくことに
     注意されたい. % <- ここどうなん？
     \begin{align*}
      initial:\hspace{0.2cm} & S_0 \\
      1^{st} cycle:\hspace{0.2cm} & B_1S_1 \\
      2^{nd} cycel:\hspace{0.2cm} & B_1<B_2S_2><B_3S_3> \\
      3^{rd} cycel:\hspace{0.2cm} & B_1<B_2B_4S_4><B_3T_1> \\
      4^{th} cycel:\hspace{0.2cm} & B_1<B_2B_4<B_5S_5><B_6S_6>><B_3T_1> \\
      \cdots \\
      finish:\hspace{0.2cm} & B_1<B_2B_4<B_5B_7B_{10}T_3><B_6<B_8T_2><B_9B_{11}T_4>>><B_3T_1> \\
     \end{align*}

     \begin{figure}[H]
      \centering
      \includegraphics[width=10cm]{./Images_Method/L-system.eps}
      \caption{形態生成L-systemの適用例}
      \label{fig:sample_L-system}
     \end{figure}

     また, 形態生成L-systemにおいて記号$S_i$の分岐や伸張によって
     新たな記号$B_j$が生成される際にはそれに対応した$Branch_j$を以下の\ref{makeBranch}節
     に示す方法で作成する. 

   \subsection{パラメータセット, $Branch$, $Dendrite$, $Neuron$の定義}
     \subsubsection{パラメータセットの定義}
       1つの樹状突起は1組のパラメータセットから作成される. 上述の通り, 1つの神経細胞は2本の樹状突起
       を持つと定義したため, 1つの神経細胞は2組のパラメータセットから生成される. 
       1つのパラメータセットには樹状突起の形態を決定するためのパラメータと樹状突起上の
       コンダクタンス分布を決定するためのパラメータが存在する. 前者のパラメータを形態パラメータ, 後者の
       パラメータをコンダクタンスパラメータと呼ぶ. 
       表\ref{morpho_parameter}は樹状突起形態を生成するために使用する形態パラメータである.

       \begin{table}[H]
         \caption{形態パラメータ}  % <- パラメータは最後にまとめた方がいいかも
         \label{morpho_parameter}
         \begin{center}
           \begin{tabular}[H]{|c|l|l|c|} \hline
             \multicolumn{1}{|c}{No.} & \multicolumn{1}{|c}{パラメータ名} & \multicolumn{1}{|c|}{説明} & \multicolumn{1}{c|}{値域}\\ \hline \hline
             1 &  \textit{Segment Length} [${\rm {\mu}m}$]& StemおよびBranchの長さ & [$0,\infty$) \\ \hline
             2 &  \textit{Stem diameter}  [${\rm {\mu}m}$]& Stemの直径 & [$0.15,\infty$) \\ \hline
             3 &  \textit{Stem elevation} [$^{\circ}$]& Stemの仰角 & [$0,360$) \\ \hline
             4 &  \textit{Stem rotation}  [$^{\circ}$]& Stemの回転角 & [$0,360$) \\ \hline
             5 &  \textit{Branch elevation $\mu$} [$^{\circ}$]& Branchの仰角決定に用いる平均値 & [$0,360$) \\ \hline
             6 &  \textit{Branch elevation $\sigma$} [$^{\circ}$] & Branchの仰角決定に用いる標準偏差値 & [$0,\infty$) \\ \hline
             7 &  \textit{Branch rotation $\mu$}  [$^{\circ}$]& Branchの回転角決定に用いる平均値 & [$0,360$) \\ \hline
             8 & \textit{Branch rotation $\sigma$} [$^{\circ}$] & Branchの回転角決定に用いる標準偏差値 & [$0,\infty$)  \\ \hline
             9 &  \textit{Bifurcation} $\alpha$ & 樹状構造の分岐導入判定に用いる$k$値 & [$1,\infty$) \\ \hline
             10 & \textit{Bifurcation} $\beta$  & 樹状構造の分岐導入判定に用いる$\theta$値 & [$1,\infty$) \\ \hline
             11 & \textit{Termination} $\alpha$ & 樹状構造の終端点導入判定に用いる$k$値 & [$1,\infty$) \\ \hline
             12 & \textit{Termination} $\beta$  & 樹状構造の終端点導入判定に用いる$\theta$値 & [$1,\infty$) \\ \hline
           \end{tabular}
         \end{center}
       \end{table}

       以下にコンダクタンスパラメータを示す. 本研究では樹状突起上のコンダクタンス分布を決定する際に
       線形分布, またはガウス分布のどちらかの分布様式を用いる. 
       樹状突起上のコンダクタンスを線形に分布させる場合は
       表\ref{liner_parameter}に示される線形コンダクタンスパラメータを,
       ガウス分布に従って分布させる場合には
       表\ref{gausian_parameter}に示されるガウス分布コンダクタンスパラメータをそれぞれ用いる.

       \begin{table}[H]
         \caption{線形分布コンダクタンスパラメータ}
         \label{liner_parameter}
         \begin{center}
           \begin{tabular}[H]{|c|l|l|c|} \hline
             \multicolumn{1}{|c}{No.} & \multicolumn{1}{|c}{パラメータ名} & \multicolumn{1}{|c|}{説明} & \multicolumn{1}{c|}{値域}\\ \hline \hline
             13 & Ka \textit{Stem conductance} [${\rm S/cm^2}$]& StemのKaコンダクタンス値 & [$0,0.22$] \\ \hline
             14 & Ka \textit{taper rate}  & Kaコンダクタンスの伝搬率 & [$0,\infty$) \\ \hline
             15 & CaT \textit{Stem conductance} [${\rm S/cm^2}$]& StemのCaTコンダクタンス値 & [$0,0.0022$] \\ \hline
             16 & CaT \textit{taper rate}  & CaTコンダクタンスの伝搬率 & [$0,\infty$) \\ \hline
           \end{tabular}
         \end{center}
       \end{table}

       \begin{table}[H]
         \caption{ガウス分布コンダクタンスパラメータ}
         \label{gausian_parameter}
         \begin{center}
           \hspace*{-4em}
           \begin{tabular}[H]{|c|l|l|c|} \hline
             \multicolumn{1}{|c}{No.} & \multicolumn{1}{|c}{パラメータ名} & \multicolumn{1}{|c|}{説明} & \multicolumn{1}{c|}{値域}\\ \hline \hline
             13 & Ka \textit{peak} [${\rm S/cm^2}$]&  Kaコンダクタンス分布の最大値 & [$0,0.22$] \\ \hline
             14 & Ka \textit{Gausian} $\mu$ & Kaコンダクタンス分布が従うガウス分布の平均値 & [$0,1$] \\ \hline
             15 & Ka \textit{Gausian} $\sigma$ & Kaコンダクタンス分布が従うガウス分布の標準偏差値 & [$0,\infty$) \\ \hline
             16 & CaT \textit{peak} [${\rm S/cm^2}$]&  CaTコンダクタンス分布の最大値 & [$0,0.0022$] \\ \hline
             17 & CaT \textit{Gausian} $\mu$ & CaTコンダクタンス分布が従うガウス分布の平均値 & [$0,1$] \\ \hline
             18 & CaT \textit{Gausian} $\sigma$& CaTコンダクタンス分布が従うガウス分布の標準偏差値 & [$0,\infty$) \\ \hline
           \end{tabular}
         \end{center}
       \end{table}

       よって1組のパラメータセットは形態パラメータにコンダクタンスパラメータを加えた16, または18項目で構成されている.
     \subsubsection{$Branch,Dendrite,Neuron$の定義}
     ひとつのBranchは長さ($length$), 底面の直径($diam$), 仰角($elevation$),
     回転角($rotation$)を形態を表現するパラメータとして持つ.
     よって, ある$Branch_i$は4つの形態パラメータからなり,
       \begin{equation*}
         Branch_i = \{length_i, diam_i, elevation_i, rotation_i\}
       \end{equation*}
       と表すことができる. またインデックス$i = 1$のとき, すなわち$Branch_1$はStemである.
       また$Dendrite$は$Branch$の集合であり, 
       \begin{equation*}
         Dendrite_i = \{Branch_{i,1},Branch_{i,2},\dots,Branch_{i_{N_i}}\}
       \end{equation*}
       また, 1つの神経細胞($Neuron$)は$Soma$と2つの$Dendrite$からなる. よって
       \begin{equation*}
         Neuron_i = \{Soma_i,Dendrite_{i,1},Dendrite_{i,2}\}
       \end{equation*}
       となる. 

 \subsection{$Branch$形態パラメータ決定方法} \label{makeBranch}
   以下に$Branch_i$のパラメータ決定方法を述べる. また, 以下の一連のパラメータ決定手法を
   関数makeBranch($diam_{parent}$)とする. 関数makeBranchは引数として親$Branch$の直径$diam_{parent}$
   を取り, 新たな$Branch$を返す関数である. 
   \begin{enumerate}
    \item \textbf{長さ({$length_i$})の決定}\\
      長さ$length_i$はパラメータセットにある
      \textit{Segment Length}の値そのものである. 
      \begin{equation}
        length_i = Segment\hspace{1mm} Length
      \end{equation}
    \item \textbf{直径($diam_i$)の決定}\\
      {\textit Branch}が分岐(Bifurcation $ S \to <BS><BS>$)によって生成されるか
      伸張(Elongation $1 \to 21$)によって生成されるかによって決定方法が異なる. 
      \begin{itemize}
        \item{分岐(Bifurcation)の場合} \\
          親となる$Branch$の太さ($diam_{parent}$)を用いて,
          ガウス分布($\mu = diam_{parent},\sigma=0.05$)
          に従う乱数を生成し  , その値を$diam_i$とする. 平均$\mu$, 標準偏差$\sigma$に従う
          乱数を1つ生成する関数をG($\mu,{\sigma}^2$)とすると
          \begin{equation}
            diam_i = G(diam_{parent},(0.05)^2)
          \end{equation}
        \item{伸張(Elongation)の場合} \\
          {\textit Branch}がStemであるかどうかによって決定方法が異なり, Stemでない場合は
          親となる$Branch$の直径($diam_{parent}$)を実数倍した値を用いる
          \begin{equation}
            diam_i = 
            \begin{cases}
              Stem\hspace{1mm}diam & \text{(i = 1)}\\
              diam_{parent} \times taper\hspace{1mm}rate & \text{(otherwise)}\\
            \end{cases}\\
      \end{equation}
      ここで, $taper\hspace{0.1cm}rate = 0.875$であり, $diam$の減衰率を表す.
      \end{itemize}
    \item \textbf{仰角($elevation_i$)の決定}\\
      {\textit diam}と同様にStemであるかどうかで決定方法が異なる. Stemの場合は形態パラメータの\textit{Stem elevation}の値を
      そのまま用いる. Stemでない場合は平均$\mu = Branch\hspace{1mm}elevation\hspace{1mm}\mu$,
      標準偏差$\sigma = Branch\hspace{1mm}elevation\hspace{1mm}\sigma$に従うガウス分布から乱数を発生させ, その値を$elevation_i$とする.
      \begin{equation}
        elevation_i = 
        \begin{cases}
          Stem\hspace{1mm}elevation & \text{(i = 1)}\\
          G(Branch\hspace{1mm}elevation\hspace{1mm}\mu,(Branch\hspace{1mm}elevation\hspace{1mm}\sigma)^2) & \text{(otherwise)}\\
       \end{cases}\\
      \end{equation}
    \item \textbf{回転角($rotation_i$)の決定}\\
      仰角の場合と同様に, 平均$\mu = Branch\hspace{1mm}rotation\hspace{1mm}\mu$,
      標準偏差$\sigma = Branch\hspace{1mm}rotation\hspace{1mm}\sigma$に従うガウス分布から乱数を発生させ, その値を$rotation_i$とする.
      \begin{equation}
        rotation_i = 
        \begin{cases}
          Stem\hspace{1mm}rotation & \text{(i = 1)}\\
          G(Branch\hspace{1mm}rotation\hspace{1mm}\mu,(Branch\hspace{1mm}rotation\hspace{1mm}\sigma)^2) & \text{(otherwise)}\\
       \end{cases}\\
      \end{equation}
   \end{enumerate}

 \subsection{記号Sの置き換え規則}
   形態生成L-systemにおける記号$B$は$Branch$に対応し, 文字列は図
   \ref{fig:sample_L-system}に示すように樹状構造を表現する.
   Stem, ($B_1$)から樹状構造を辿り, 文字列中のある記号$S_i$に至るまでに通
   過する記号$B$の添え字の集合を$J = \{1,2,\cdots,n\}$とする.
   このとき$length_j\hspace{2mm}(j \in J)$の和を${\rm path(S_i)}$とする.
   すなわち, 記号$B_j$を対応する$Branch_j$に置き換え構成される樹状構造を根
   元から記号$S_i$の位置まで辿った距離である. 
   \begin{figure}[H]
     \centering
     \includegraphics[width=5cm]{./Images_Method/path_S.eps}
     \caption{${\rm path}(S_i)$}
     \label{path(S_i)}
   \end{figure}
   以下に記号$S_i$の置き換え規則($*$)の選択方法と, その際に考慮するヒュー
   リスティックスについて示す. ここで$N_B$を各置き換えステップにおいての
   記号$B$の総個数, $N_T$を記号$T$の総個数であるとする. また, 置き換えの
   初期状態は$\{S_0\}$と表す. 
   \begin{enumerate}
     \item \textbf{停止 Termination $S_i \to T_{N_T + 1}$} \\
        $[0,1]$の範囲で一様分布に従う乱数を一つ生成し, その値を$rand$とする.
        累積ガンマ分布\textit{Cumulative} $\gamma$($x,k,\theta$)を用いて記号$S_i$の伸張停止
        の判定を行う. その際, 累積ガンマ分布のパラメータとしてパラメータセットの値を用いる.
        \begin{equation}
	  {\rm Cumulative}\hspace{0.1cm}\gamma\hspace{0.05cm}({\rm path(S_i)},
          Termination\hspace{1mm}{\alpha},Termination\hspace{1mm}{\beta} ) > rand
        \end{equation}
        となる場合, 伸張停止(Termination)とし$ S_i \to T_{N_T + 1}$とする.

      \item \textbf{分岐 Bifurcation $ S_i \to <B_{N_B + 1}S_{N_B + 1}><B_{N_B + 2}S_{N_B + 2}>$} \\
        Terminationを行わなかった場合のみBifurcationの判断を行う. 
        $[0,1]$の範囲で一様分布から乱数を一つ生成し, その値を$rand$とする.
        最大値が0.8になるように実数倍したガンマ分布
        \textit{Scaled} $\gamma$($x,k,\theta$)を用を用いて分岐の判定を行う. 
        ただしガンマ分布のパラメータとして, パラメータセットの値を用いる. 
        \begin{equation}
	  Scaled\hspace{0.1cm}\gamma\hspace{0.05cm}(path(S_i),
          Bifurcation\hspace{1mm}\alpha,Bifurcation\hspace{1mm}\beta) > rand
        \end{equation}
        のとき分岐(Bifurcation)とする. すなわち$Branch_i$の$diam_i$を用いて\\
        makeBranch($diam_i$)から新たに$Branch_{N_B + 1}$と$Branch_{N_B + 2}$を生成する.
      \item \textbf{伸張 Elongation $S_i \to B_{N_B + 1}S_{N_B + 1}$} \\
        上記の2条件を満たさなかった場合, 伸張(Elongation)とする. 
        すなわち$Branch_i$の$diam_i$を用いてmakeBranch($diam_i$)より, 新たに$Branch_{N_B + 1}$を生成する. 
    \end{enumerate}

   \subsubsection{形態的ヒューリスティック}
    以下の条件に該当する場合は強制的に伸張停止(Termination)とする. これは樹
    状突起として妥当な形態を得るために導入するヒューリスティックスである.    % <- 妥当とは?
    \begin{itemize}
      \item ${\rm path}(S_i) > 2000$のとき
      \item $diam_{parent} \le Minimum\hspace{1mm}diameter$ のとき\\ % <- パラメータをあとでまとめたほうがいいか？
       また, この場合, 親$Branch$の$diam$を$Minimum\hspace{1mm}diameter$
	    に設定し直す.ここで$Minimum\hspace{1mm}diameter = 0.15$[$\mu$m]である. 
    \end{itemize}

    \subsection{$Branch$に対する三次元座標の設定}
     $length_i$, $elevation_i$, $rotation_i$の情報を用いて三次元空間上での$Branch_i$の座標情報を
     設定する. $Branch_i$の伸張方向は親となるBranchの向きにあわせた相
     対的な座標軸を用いて考える. 具体的には以下のようにする. 
     \begin{itemize}
     \item \textbf{Stemの角度設定($i = 1$)}
       \begin{enumerate}
       \item 仰角 \\
	 仰角を$elevation^{\circ}$とする. 初期状態としてStemは3次元空間
	 の原点からx軸と同じ方向に伸びているとする. この状態からStemを, z軸
	 を中心として右ねじの方向に$elevation^{\circ}$回転させる.
	 この際y軸, x軸も同様に回転を行い, それぞれy'軸, x'軸と
	 する.この状態を図\ref{elevation}に示す. 
       \item 回転角 \\
	 次に, 回転角を$rotation^{\circ}$とする. 仰角と同様に,
	 Stemをy'軸の右ねじの方向に$rotation^{\circ}$回転させる. また
	 x'軸, z軸についても同様の回転を行い, それぞれx''軸, z'
	 軸とする. この状態を図\ref{rotation}に示す. 
       \end{enumerate}
       \begin{figure}[h]
         \centering
         \begin{subfigure}{0.4\columnwidth}
           \centering
           \includegraphics[width=\columnwidth]{./Images_Method/elevation.eps}
           \caption{elevation}
           \label{elevation}
         \end{subfigure}
         \begin{subfigure}{0.4\columnwidth}
           \centering
           \includegraphics[width=\columnwidth]{./Images_Method/rotation.eps}
           \caption{rotation}
           \label{rotation}
         \end{subfigure}
         \caption{仰角, 回転角の設定}
         \label{Branch_round}
       \end{figure}
     \item \textbf{Branchの角度設定} \\
       Stemと同様に行う. ただし, その$Branch$の親となる$Branch$によっ
       て回転を与えたx'',y',z'軸を用いる. 
   \end{itemize}
     これらの処理の後, $Dendrite$全体を$Soma$の表面に接するようにStemの方向に
     平行移動させる. 

    \subsection{シナプティックゾーン}
     3次元空間上の原点に$Soma$を配置し, $y$軸方向の$170 < y < 190$の範囲を % <- この辺の座標情報を変数にしたほうがいいかも
     Redシナプティックゾーン, $y$軸方向の$-170 > y > -190$の範囲をBlueシナプティック
     ゾーンと定義する(図\ref{synaptic-zone}). シナプティックゾーン内に$Branch$が侵入した
     場合, $Branch$上にシナプスを付与する. 具体的には下記
     \ref{synapse_setting}節にて詳述する. 

 \section{数理モデル}
   \subsection{作成した神経細胞の数理モデル化}
   形態生成L-systemによって得られた$Neuron$を数理モデルに変換する手法を示す. 
   1つの$Branch$は最大5[$\mu$m]の大きさに分割して, それぞれに膜電位を計算する.
   ある実数$x$に対して, $x$以上の最小の整数を返す関数をceiling($x$)とする.
   このとき, ある$Branch_i$を分割する個数$d_i$は, $Branch_i$の長さ$length_i$
   を用いて以下のように定義する. 
   \begin{align}
     d_i &= 
     \begin{cases}
       {\rm ceiling}(\frac{length_i}{5}) & \text{(${\rm ceiling}(\frac{length_i}{5})$ is odd)}\\
       {\rm ceiling}(\frac{length_i}{5}) + 1 & \text{(${\rm ceiling}(\frac{length_i}{5})$ is even)}
     \end{cases}
   \end{align}
   ここで$d_i$を奇数とするのはシミュレーションにNEURONを用いているためである.% <- できたら理由を書きたい
   よって$Branch_i$は$\frac{length_i}{d_i}$の長さごとに1つのコンパートメントに分割され
   $Comp_{i,j}\hspace{1mm}(j = 1,2,\dots,d_i)$となる. 
   また, $Soma$はコンパートメントへの分割は行わない.
   \subsection{神経細胞モデル, シナプスモデル}
     上記の方法で分割された$Comp_{i,j}$と$Soma$は以下の式\ref{V_i}
     を用いてその膜電位の挙動をシミュレーションする. 
     単一コンパートメントの膜電位($V_i$)は以下の式によって計算される.
     %g_leakは平衡電位 = -70になるように調節している
     \begin{equation}
       Cm\frac{dV}{dt} = g_{leak}(V - E_{leak}) + I_{CaT} + I_{Ka}
       %このcmは小文字か大文字か?
       \label{V_i}
     \end{equation}
     コンパートメントの膜上にシナプスが分布している場合は上式\ref{V_i}の右
     辺に以下の項を加える.
     \begin{equation}
       (e^{-\frac{t}{{\tau}2}} - e^{-\frac{t}{{\tau}1}}) {\cdot} g_{syn} {\cdot} (V
       - E_{syn})
       \label{eq_syn}
     \end{equation}

     また, 他のコンパートメントが結合している場合は以下の式\ref{next_comp}を
     式\ref{V_i}に加える.
      $i$番目のコンパートメントに$j$番目のコンパートメントが結合しているとき,
     \begin{equation}
       g_{i,j} {\cdot}(V_j - V_i)
       \label{next_comp}
     \end{equation}
     ここで$g_{i,j}$は2つのコンパートメント間のコンダクタンスを表し,
     $i$番目のコンパートメントの半径を${\alpha}_i$, 長さを$L_i$とすると,
     以下の式で表される.
     \begin{equation}
       g_{i,j} = \frac{{\alpha}_i{{\alpha}_j}^2}
       {Ra{\cdot}L_i(L_i{{\alpha}_j}^2 +  L_j{{\alpha}_i}^2)}
     \end{equation}
     
   \subsection{イオンチャネルモデル}
   式\ref{V_i}のイオンチャネルモデル$I_{CaT}$, $I_{Ka}$は
   Migliore et al. に示されるイオンチャネルの
     モデルを使用している.\cite{migliore1995computer}
     \begin{itemize}
       \item 電位依存型T型${\rm Ca^{2+}}$電流
         \begin{align}
           I_{CaT} &= g_{CaT} {\cdot} ghk(V,cai,cao) \\                   
           g_{CaT} &= \overline{g}_{CaT} {\cdot} m^2 {\cdot} h  \\
           KTF &= \left(\frac{25.0}{293.15}\right) {\cdot} (T + 273.15) \\
           f &= \frac{KTF}{2} \\
           nu &= \frac{V}{f} \\
           ghk(V,cai,cao) &= -f {\cdot} \left(1.0 - \frac{C_i}{C_o} {\cdot} \exp(nu) \right) {\cdot} efun(nu) \\
           efun(z) &=
           \begin{cases}
             1 - \frac{z}{2} & (|z| < 10^{-4}) \\
             \frac{z}{(e^z - 1)} & (otherwise) \\
           \end{cases}
         \end{align}

         また, CaTコンダクタンスのゲート変数($m$および$h$)の挙動は以下の微分方程式によって表現される.
         
         \begin{align}
           {\tau}_{m}(V)\frac{dm}{dt} &= \frac{{\alpha}_m(V)}{{\alpha}_m(V) + {\beta}_m(V)} - m \\
           {\tau}_m(V) &= \frac{1}{{\alpha}_m(V) + {\beta}_m(V)} \\
           {\alpha}_m(V) &= 0.2{\cdot}\frac{-V + 19.26}{\exp(\frac{-V + 19.26}{10}) - 1} \\
           {\beta}_m(V) &= 0.009{\cdot}\exp(-\frac{V}{22.03})
         \end{align}

         \begin{align}
           {\tau}_{h}(V)\frac{dh}{dt} &= \frac{{\alpha}_h(V)}{{\alpha}_h(V) + {\beta}_h(V)} - h\\
           {\tau}_{h}(V) &= \frac{1}{{\alpha}_h(V) + {\beta}_h(V)} \\
           {\alpha}_h(V) &= 10^{-6}{\cdot}\exp(-\frac{V}{16.26}) \\
           {\beta}_h(V) &= \frac{1}{\exp(\frac{-V + 29.79}{10}) + 1}
         \end{align}

       \item A型K$^+$電流
         \begin{align}
           I_{Ka} &= g_{Ka}{\cdot}(V - E_{K}) \\
           g_{Ka} &= \overline{g}_{Ka}{\cdot}n{\cdot}l
         \end{align}
         また, Kaコンダクタンスのゲート変数($n$および$l$)の挙動は以下の微分方程式によって表現される.
         \begin{align}
           {\tau}_n(V)\frac{dn}{dt} &= \frac{1}{1 + {\alpha}_n(V)} - n \\
           {\tau}_n(V) &= \frac{{\beta}_n(V)}{Q_{10}{\cdot}{\alpha}_{0n}{\cdot}(1 + {\alpha}_n(V))} \\
           {\alpha}_n(V) &= {\exp}\left(\frac{10^{-3}{\cdot}{\zeta}_n{\cdot}(V - V_{n\frac{1}{2}}){\cdot}9.648{\cdot}10^4}
                                             {8.315{\cdot}(273.16 + T)} \right) \\
           {\beta}_n(V) &= {\exp}\left(\frac{10^{-3}{\cdot}{\zeta}_n{\cdot}gm_n{\cdot}(V - V_{n\frac{1}{2}}){\cdot}9.648{\cdot}10^4}
                                             {8.315{\cdot}(273.16 + T)} \right)
         \end{align}

         \begin{align}
           {\tau}_l(V)\frac{dl}{dt} &= \frac{1}{1 + {\alpha}_l(V)} - l \\
           {\tau}_l(V) &= \frac{{\beta}_l(V)}{Q_{10}{\cdot}{\alpha}_{0l}{\cdot}(1 + {\alpha}_l(V))} \\
           {\alpha}_l(V) &= {\exp}\left(\frac{10^{-3}{\cdot}{\zeta}_l{\cdot}(V - V_{l\frac{1}{2}}){\cdot}9.648{\cdot}10^4}
                                             {8.315{\cdot}(273.16 + T)} \right) \\
           {\beta}_l(V) &= {\exp}\left(\frac{10^{-3}{\cdot}{\zeta}_l{\cdot}gm_l{\cdot}(V - V_{l\frac{1}{2}}){\cdot}9.648{\cdot}10^4}
                                             {8.315{\cdot}(273.16 + T)} \right)
         \end{align}
     \end{itemize}

     ただし
     \begin{align}
       Q_{10} &= 3^{(\frac{T - 30}{10})}
     \end{align}
     である.
%
% gmn gmlは何なのか？ g_{mn}なのか？ 単位は無いようなので、gmnだと思う
%
     数理モデルのパラメータを以下の表\ref{sim_param}に示す. % <- tau1 tau2は別のソースコードからとったことを書いたほうがいい

     \begin{table}[H]
       \caption{数理モデルパラメータ}
       \label{sim_param}
       \centering
       \begin{subtable}{0.45\columnwidth}
         \centering
         \caption{神経細胞モデルパラメータ}
         \label{neuron_param}
         \begin{tabular}[h]{|c||c|} \hline
           \multicolumn{1}{|c||}{パラメータ名} & \multicolumn{1}{c|}{値} \\ \hline \hline
%	   Simulation time [ms]& 50 または 100 \\\hline % <- ここ変える
	   $Ra$  [${\rm{\Omega}cm}$] & 100 \\ \hline
	   $Cm$  [${\rm{\mu}F/cm^2}$] & 0.8 \\ \hline
	   $V_{init}$ [mV]& -70\\ \hline
	   $g_{pas}$ [${\rm S/cm^2}$]& $2.5 \times 10^{-5}$\\ \hline
	   $E_{pas}$ [mV] & -70\\ \hline
           $g_{syn}$ [${\rm S/cm^2}$]& 0 \\ \hline
           ${\tau}_{1}$ [ms] & 0.5\\ \hline
	   ${\tau}_{2}$ [ms] & 2\\ \hline
         \end{tabular}
       \end{subtable}
       \begin{subtable}{0.45\columnwidth}
         \centering
         \caption{イオンチャネルモデルパラメータ}
         \label{cond_param}
         \begin{tabular}[h]{|c||c|} \hline
           \multicolumn{1}{|c||}{パラメータ名} & \multicolumn{1}{c|}{値} \\ \hline \hline
           $T$ [${\rm ^{\circ}C}$] & 37\\ \hline
           $E_{K}$ [mV] & -91\\ \hline
%           $\overline{g}_{CaT}$ [${\rm S/cm^2}$]& 0.003\\ \hline
%           $\overline{g}_{Ka}$ [${\rm S/cm^2}$]& 0.01\\ \hline
           ${\alpha}_{0n}$ [${\rm ms^{-1}}$]& 0.02\\ \hline
           ${\alpha}_{0l}$ [${\rm ms^{-1}}$]& 0.08\\ \hline
           ${\zeta}_n$ & -3\\ \hline
           ${\zeta}_l$ & 4\\ \hline
           $gm_n$ & 0.6\\ \hline
           $gm_l$ & 1\\ \hline
           $V_{n\frac{1}{2}}$ [mV]& -33.6\\ \hline
           $V_{l\frac{1}{2}}$ [mV]& -83\\ \hline
           $C_i$ [mM]& $5.0{\times}10^{-5}$\\ \hline
           $C_o$ [mM]& 2.0\\ \hline
         \end{tabular}
       \end{subtable}
     \end{table}

   \subsection{コンパートメント上のコンダクタンス分布設定}
     作成した$Comp_{i,j}$のそれぞれに最大コンダクタンス値${\overline{g}_{\rm CaT}}_{i,j}$, ${\overline{g}_{\rm Ka}}_{i,j}$
     を設定する. 
     樹状突起上のコンダクタンス分布は線形分布とガウス分布のどちらかを使用する.
     線形分布はコンダクタンスは$Branch$ごとに線形に変化させるという手法
     である.\cite{torben2009systematic}.
     ガウス分布は$Comp$ごとにコンダクタンスを変化させ, 線形分布の場合よりも細かくコンダクタンス
     分布を設定できる. 
     $Soma$に対してはコンダクタンスを分布させず,
     ${\overline{g}_{soma}}_{{\rm Ka}} = {{\overline{g}}_{soma}}_{\rm CaT} = 0$とした.
     以下に$Comp_{i,j}$に対するコンダクタンス値の決定方法を述べる. 
     \begin{itemize}
     \item \textbf{線形分布の場合}\\
       $Branch$単位でコンダクタンスを設定する. つまりある$Branch_i$から分割されたコンパートメント$Comp_{i,j}$は
       全て同じコンダクタンス値を持つ. $Branch_i$のコンパートメントのコンダクタンス値を
       ${\overline{g}_{\rm CaT}}_{i}$, ${\overline{g}_{\rm Ka}}_{i}$とし,
       上記の$diam$と同様に親$Branch$の持つコンダクタンス$g_{parent_i}$の実数倍として決定する\\
       \begin{align}
         {\overline{g}_{\rm CaT}}_{i,j} &= 
         \begin{cases}
           {\rm CaT}\hspace{1mm}Stem\hspace{1mm}conductance & \text{(i = 1)}\\
           {\overline{g}_{\rm CaT}}_{parent_i} \times {\rm CaT}\hspace{1mm}taper\hspace{1mm}rate & \text{(otherwise)}\\
         \end{cases} \\
         {\overline{g}_{\rm Ka}}_{i,j} &= 
          \begin{cases}
            {\rm Ka}\hspace{1mm}Stem\hspace{1mm}conductance & \text{(i = 1)}\\
            {\overline{g}_{\rm Ka}}_{parent_i} \times {\rm Ka}\hspace{1mm}taper\hspace{1mm}rate & \text{(otherwise)}
           \end{cases}
         \end{align}

       \item \textbf{ガウス分布の場合}\\
         コンパートメント単位でコンダクタンス値を設定する. Stemから$Comp_{i,j}$までの
         $length$の合計をpath($Comp_{i,j}$)とする. 
         また$Dendrite_i$での最大のpath($Comp_{i,j'}$)を
         max(Path($Comp_{i,j'}$))とする.
         この二つの長さの比を$path\hspace{1mm}ratio(Comp_{i,j}) = \frac{Comp_{i,j}}{{\rm max(Path(}Comp_{i,j'}))}$とする. 
         このとき平均値$\mu$, 標準偏差$\sigma$のガウス分布から実数$x$に対する確率密度を
         返す関数N($x,\mu,{\sigma}^2$)を用いて
         \begin{align}
           {\rm Ka}\hspace{1mm}Gaus\hspace{1mm}Max &= {\rm N}({\rm Ka}\hspace{1mm}Gausian\hspace{1mm}\mu,{\rm Ka}\hspace{1mm}Gausian\hspace{1mm}\mu,({\rm Ka}\hspace{1mm}Gausian\hspace{1mm}\sigma)^2) \\
           {\rm CaT}\hspace{1mm}Gaus\hspace{1mm}Max &= {\rm N}({\rm CaT}\hspace{1mm}Gausian\hspace{1mm}\mu,{\rm CaT}\hspace{1mm}Gausian\hspace{1mm}\mu,({\rm CaT}\hspace{1mm}Gausian\hspace{1mm}\sigma)^2)
         \end{align}
         
         とし,
         
       \begin{align}
         {\overline{g}_{\rm Ka}}_{i,j} &=
         \frac{{\rm N}(path\hspace{1mm}ratio(Comp_{i,j}),{\rm Ka}\hspace{1mm}Gausian\hspace{1mm}\mu,({\rm Ka}\hspace{1mm}Gausian\hspace{1mm}\sigma)^2)}
              {{\rm Ka}\hspace{1mm}Gaus\hspace{1mm}Max}
              \times {\rm Ka}\hspace{1mm}peak \\
         {\overline{g}_{\rm CaT}}_{i,j} &=
         \frac{{\rm N}(path\hspace{1mm}ratio(Comp_{i,j}),{\rm CaT}\hspace{1mm}Gausian\hspace{1mm}\mu,({\rm CaT}\hspace{1mm}Gausian\hspace{1mm}\sigma)^2)}
              {{\rm CaT}\hspace{1mm}Gaus\hspace{1mm}Max}
              \times {\rm CaT}\hspace{1mm}peak
       \end{align}
     \end{itemize}
   とする.
   \subsection{単一コンパートメントへのシナプスの付与} \label{synapse_setting}
     上記のように分割した$Comp_{i,j}$が一部分でも$170 < y < 190$の領域に入っていた場合,  % <- この辺の座標情報を変数にしたほうがいいかも
     Redシナプスを付与する. 具体的には$Comp_{i,j}$の
     膜電位を示す式\ref{V_i}の右辺に\ref{eq_syn}を加える. また, y軸方向の$-170 > y > -190$
     に入っていた場合はBlueシナプスを付与する.
     
 \section{遺伝アルゴリズム}    % <- 「遺伝アルゴリズム」という名前はどうなのか？
   2組のパラメータセットを1つの個体として200個体, 世代数500で遺伝アルゴ
   リズムを用いたパラメータ最適化を行った.  % <- 遺伝アルゴリズムのパラメータもどこかで表にまとめた方がいい
   1組のパラメータセットをベクトル$\overrightarrow{P}_i = \{p_{i,1},p_{i,2},\dots \}$
   と表すと, 一つの個体は$u_i = \{\overrightarrow{P}_{i,1},\overrightarrow{P}_{i,2}\}$
   と表される. 
   また$\overrightarrow{P}_i$から生成される樹状突起を$Dendrite_i$とする. よっ
   て1つの個体$u_i$から生成される神経細胞は$Neuron_i = \{Dendrite_{i,1},Dendrite_{i,2}\}$
   と表される.   
   また, ある世代数$g$での$i$番目の個体を$u_{g,i}$と表す. 
   この遺伝アルゴリズムにおける遺伝子は個体$u_{g,i}$の持つパラメータセット$P_{g,i,1},P_{g,i,2}$
   である. 
   本研究の遺伝アルゴリズムでは, エリート保存, 一点交叉, 突然変異を用いた.
   以下にその詳細を述べる. 
   \subsection{個体評価}
     各世代$g$で個体$u_{g,i}$から神経細胞形態$Neuron_{g,i}$を生成した後,
     以下のシミュレーションプロトコルを実行する.
     \subsubsection{シミュレーションプロトコル}
       ある個体$u_{g,i}$から作成された$Neuron_{g,i}$に対して, 以下のシミュレーションを行う.
       またBlueシナプスを活性化させる時刻を$t_{Blue}$[ms],
       Redシナプスを活性化させる時刻を$t_{Red}$[ms]とする.
       シミュレーション時間はCaTコンダクタンスが単独で分布している場合は100ms, それ以外の場合
       は50msである. また, $Neuron_{g,i}$の細胞体$Soma_{g,i}$で観測される最大の膜電位上昇量を
       $R$とする. シミュレーションは以下の表に示される$t_{Blue}$, $t_{Red}$の組みを用いて,
       1つの$Neuron_{g,i}$につき計4回行われる.
       シミュレーションはNEURONシミュレータで行い, CVodeアルゴリズムを用いた. % <- NEURON シミュレータに関して書いた方がいいか？
       CVodeアルゴリズムを用いる際のエラー許容量は$10^{-5}$に設定した. 
       
       \begin{table}[H]
         \begin{center}
           \begin{tabular}[H]{|c||c|c||c|} \hline
             No. & $t_{Blue}$[ms] & $t_{Red}$[ms] & $R$ \\ \hline \hline
             1 & 5 & Not activated & $R_{Blue}$\\ \hline
             2 & Not activated & 5 & $R_{Red}$\\ \hline
             3 & 5 & ${\Delta}t$ + 5 & $R_{Blue \to Red}$\\ \hline
             4 & ${\Delta}t$ + 5 & 5 & $R_{Red \to Blue}$\\ \hline
           \end{tabular}
         \end{center}
       \end{table}

   \subsection{評価値$E$の計算}
     上記のシミュレーションの結果をもとに個体の評価を行う.
     個体の評価には, 個体の機能性(式\ref{F})のほか$Neuron$
     の体積, 分布するコンダクタンスの量を考慮する. 
     しかし, 個体によっては上下のシナプティックゾーンに樹状突起を伸ばせず, 
     そもそもシミュレーションを行うことができないものが発生することもある.
     また神経細胞をより実物に近づけることと, 妥当なシミュレーションを行うことを % <- 妥当とは？
     目的としていくつかのヒューリスティックスを導入した. 
     また, 世代数$g$, 添え字$i$の個体の評価値$E$を$E_{g,i}$と表記する
     以下に個体の評価方法を述べる. \\
     \begin{itemize}
       \item \textbf{形態的エラー}\\
         個体から生成した$Neuron$が両方のシナプティックゾーンにシナプスを持たず,
         シミュレーションを全て行えない場合
         $Dendrite_{i,1}$の$y$座標の最大値をmax($y_1$), $Dendrite_{i,2}$の$y$座標の
         最小値をmin($y_2$)とし評価値$E_{i,g}$を
         \begin{equation}
           E_{g,i} = -{\rm max}\left(170 - {\rm max}(y_1),0\right) + {\rm min}\left(-170 - {\rm min}(y_2),0\right) - 100
           \label{Morpho_E}
         \end{equation}
         とする. 
       \item 個体から生成した$Neuron$が両方のシナプティックゾーンにシナプスを持ち, 上記4つの
         シミュレーションを全て行った場合は, その世代での相対的な評価値を与える. そのような個体
         の添え字の集合を$S_g$とする. ここで個体$u_{g,s}\hspace{1mm}(s \in S_g)$について,
         その中での最大の$F$値をmax$(F_g)$, また個体$u_{g,s}$から作られた
         神経細胞形態を$Neuron_{g,s}$とし, その中で最大の体積を${Volume_{max}}_i$,
         CaTコンダクタンスの最大のコンダクタンス量を
         ${\rm CaT}\hspace{1mm}{{amount}_{max}}_g$, Kaコンダクタンスの最大の
         コンダクタンス量を${\rm Ka}\hspace{1mm}{{amount}_{max}}_g$とする.
         ここで, コンダクタンス量とはその$Neuron$の各コンパートメントの表面積にコンダクタンス
         をかけた値の総量である. 
         このとき, ある個体$u_{g,i}$の評価値$E_{g,i}$は以下のように決定する. \\
         まず個体$u_{g,i}$に分布するコンダクタンスの量を相対的に表す. その値を
         $Conductance\hspace{1mm}ratio_{g,i}$とし, 以下の式によって求める. 
         ここで$N\hspace{1mm}Conductance$は神経細胞に導入しているイオンチャネルの
         種類の個数である. % <-なんかふわっとしてる感がある
         
         \begin{equation}
           Conductance\hspace{1mm}ratio_{g,i} = \left(\frac{{\rm Ka}\hspace{1mm}amount_{g,i}}{{{\rm Ka}\hspace{1mm}amount_{max}}_{g}} +
           \frac{{\rm CaT}\hspace{1mm}amount_{g,i}}{{{\rm CaT}\hspace{1mm}amount_{max}}_{g}}\right) / N\hspace{1mm}Conductance
         \end{equation}

         その後, 個体の評価値を100からの減点方式で与える. 

         \begin{align}
           Function\hspace{1mm}Minus_{g,i} &= \left(1 - \frac{F_{g,i}}{{F_{max}}_g}\right) \times Function\hspace{1mm}ratio \\
           Morphology\hspace{1mm}Minus_{g,i} &= \frac{Volume_{g,i}}{{Volume_{max}}_g} \times Morphology\hspace{1mm}ratio \\
           Conductance\hspace{1mm}Minus_{g,i} &= \frac{Conductance\hspace{1mm}ratio_{g,i}}{{Conductance_{max}}_g} \times Conductance\hspace{1mm}ratio 
         \end{align}
         
         \begin{equation}
  E_{g,i} = 100 - (Function\hspace{1mm}Minus_{g,i} + Morphology\hspace{1mm}Minus_{g,i} + Conductance\hspace{1mm}Minus_{g,i})
         \end{equation}

     \end{itemize}

     また, 以下のヒューリスティックスに該当する個体は, 以下の式によって評価する. %上の式との関連は?
     \begin{itemize}
       \item \textbf{形態的ヒューリスティックス}\\
         以下の場合はシミュレーションの結果に依らず, 式\ref{Morpho_E}によって評価値
         $E_{g,i}$を与えた. 
         \begin{itemize}
           \item 神経細胞全体でStemとBranchの個数が合計15未満の場合
           \item 神経細胞全体で樹状突起の分岐が一つもない場合
         \end{itemize}
       \item \textbf{シミュレーションヒューリスティックス}\\
         以下に示される場合は$\mu = -50$, $\sigma = 5$のガウス分布から乱数を1つ発生させ,
         その値を評価値$E_{i,g}$とした.
         これは神経細胞での発火や, 膜電位の振動を % <- 細胞体での発火を抑制する意味は? ここコンダクタンスの時のみの考慮にしなくてもよさそう
         抑制するためである.
         \begin{itemize}
           \item $ {R_{Blue}}_i < 2$または$ {R_{Red}}_i < 2$のとき
           \item ${R_{Blue}}_i > 25$または${R_{Red}}_i > 25$のとき
	   \item シミュレーションの最後の5ステップで膜電位の上昇が起こったとき
         \end{itemize}
         この条件に当てはまったとき, 評価値$E_{g,i}$は
         \begin{equation}
           E_{g,i} = G(-50,5^2) % <- この書き方はあってるのか
           \label{penalty}
         \end{equation}
         とする. 
     \end{itemize}
     
   %% \begin{figure}[h] %評価値が層状になることを言うか？
   %%   \centering
   %%   \includegraphics[width=5cm]{./Images_Method/temp.png} 
   %%   \caption{評価値}
   %%   \label{Estimate}
     %% \end{figure}
     
   \subsection{エリート保存}
      世代$g$において最大の評価値をとった個体は, そのまま$g + 1$世代の1個体に引き継がれる.
      世代$g$においての個体の添え字を評価値の大きさ順に並べ, 順位$k$の個体の添え字を$r_k$で表す
      とする. このときエリート保存は
      
      \begin{equation}
       u_{g + 1,1} = u_{g,r_1}
      \end{equation}
      
      と表現できる.
   \subsection{一点交叉, 突然変異}
   %交叉、突然変異を起こす個体の数は中心極限定理的な考えで求められる
     次世代のエリート以外の個体は一点交叉または突然変異のどちらかの手法によって作成され
     る. 一点交叉は評価値上位$\mu$個の個体($u_{g,r_{1}},u_{g,r_{2}},\dots,u_{g,r_{\mu}}$)
     を親として, $\lambda$個の子個体を生成する. ここで$\lambda = 50$とした. 
     この$\lambda$個の子個体は評価値下位$\lambda$個の個体と交換され, 次世代の個体となる.
     突然変異は残りの$199 - \lambda$個の個体に対して適用される.
     ここで$\mu = 10$である. ここで$Parents_g =
     \{u_{g,r_{1}},u_{g,r_{2}},\dots,u_{g,r_{\mu}}\}$とし, Cross
     over($Parents$)を一点交差から次世代個体を一つ作成する関数とし,
     Mutation($u_{g,i}$)を個体に突然変異を与える関数であるとすると, 次世
     代個体$U_{g + 1}$は
     \begin{equation}
      U_{g + 1} = \left(
       \begin{array}{c}
	u_{g,r_{1}}, \\
	{\rm Cross\hspace{1mm}over(Parent_g)}_{g + 1,2}, \\
	\dots \\
	{\rm Cross\hspace{1mm}over(Parent_g)}_{g + 1,\lambda + 1}, \\ % <- これはわかりにくい
	{\rm Mutation(u_{g,r_{1}})_{g + 1,\lambda + 2}}, \\
	\dots \\
	{\rm Mutation(u_{r_{g,199 - \lambda}})_{g + 1,200}}
       \end{array}
       \right)
     \end{equation}
     \begin{itemize}
       \item \textbf{一点交叉 Cross over}\\
	     評価値上位の$\mu$個体から確率的に親を2個体選択する. 親を選択す
	     る際には以下の式\ref{Parent_P}に定義する確率分布を用いて,
	     親の添え字を指定する. 評価値が$k$番目の % <- 評価値が負の個体なども存在し、ルーレット選択などが使えないということも書く
	     個体が選択される可能性を$P_k$とし, 
	     \begin{equation} % 選択確率を円グラフで図示するか？
	      P_k =  
	       \begin{cases}
		(\frac{1}{2})^k &  k < \mu\\
		(\frac{1}{2})^{k - 1} & otherwise
		 \end{cases}\\
	      \label{Parent_P}
	     \end{equation}
	     とする.
	     なお, 同じ個体が重複して選択されないようにした. \\
	     選択された2つの親個体の添え字を$x$, $y$とする. 
	     一点交叉は親のパラメータセット$P_{g,i,1}$同士, パラメータセッ
	     ト$P_{g,i,2}$同士で以下のように行う. %なぜABを分けるのかを書いた方がわかりやすい
	     これは2つの$Dendrite_{i,1}$, $Dendrite_{i,2}$をそれぞれ別の系統とし
	     て適応させるためである.
         \begin{itemize}
           \item \textbf{交差点の決定} \\ %passiveの場合はK,Caコンダクタンスに関する部分は交叉を行っても無意味だった
             パラメータセットの項目数を$N_{Param}$とする. このとき交差点
		 \textit{Cross}は$[N_{min},N_{max}]$から
             一様な確率で整数を1つ返す関数randInt($N_{min}$,$N_{max}$)を用いて
             \begin{equation}
               Cross = {\rm randInt}(1,N_{Param} - 1)
             \end{equation}
             とする. 
           \item \textbf{交叉の実行} \\
		 新たなパラメータセットを作成する. 新たなパラメータセットを
		 $\overrightarrow{P}_{new,i}$とすると, 親のパラメータ
		 セット$\overrightarrow{P_{x}}_{i}$,
		 $\overrightarrow{P_{y}}_{i}$を用いて
		 \begin{equation}
		  \overrightarrow{P_{new}}_{i} = \{ {p_x}_{i,1}, {p_x}_{i,2},
		   \dots, {p_x}_{i,Cross}, {p_y}_{i,Cross + 1},
		   {p_y}_{i,Cross + 2}, \dots, {p_y}_{i,N_{Param}}\} %添え字が非常に煩雑
		 \end{equation}
         \end{itemize}
       \item \textbf{突然変異 Mutation}\\
        パラメータセットの各項目に対して0.65の確率でガウス分布G($\mu$,${\sigma}_M$)に従う変動を与える. すなわち, あるパラメータ値
         $p_i$に対して, 新しいパラメータ値${p'}_i$は
         \begin{equation}
           {p'}_i = p_i + G(p_i,{{\sigma}_M}^2)
           \label{Mutation}
         \end{equation}
         となる. ここで用いる${\sigma}_M$は突然変異を与える対象のパラメータによって以下の表\ref{sigma_M}に示される
         値を用いる. これはパラメータによって値のレンジが異なるためである. 
         ${p'}_i$が表\ref{sigma_M}に示される値域に収まらない場合は再度式\ref{Mutation}を用いて
         ${p'}_i$を取り直す. 
         \begin{table}[H]
           \caption{${\sigma}_M$パラメータ}
           \label{sigma_M}
           \begin{center}
	     \begin{tabular}[t]{|l|c|c|c|} \hline % <- あとパラメータの初期値
           \multicolumn{1}{|c}{パラメータ名} & \multicolumn{1}{|c|}{${\sigma}_M$} & \multicolumn{1}{c|}{値域}\\ \hline \hline
               \textit{Segment Length}            & 1                 & (0, $\infty$] \\ \hline
	       \textit{Stem diameter}		  & 0.1		      & (0, 0.15] \\ \hline
	       \textit{Stem elevation}		  & 2		      & ($-{\infty}$, ${\infty}$)\\ \cline{1-1}
	       \textit{Stem rotation}		  & 		      & \\ \cline{1-1}
	       \textit{Branch elevation} $\mu$	  & 		      &  \\ \cline{1-1}
	       \textit{Branch rotation} $\mu$	  & 		      & \\ \hline
	       \textit{Branch elevation} $\sigma$ & 0.5		      & ($-{\infty}$, ${\infty}$) \\ \cline{1-1}
	       \textit{Branch rotation} $\sigma$  & 		      & \\ \hline
	       \textit{Bifurcation} $\alpha$	  & 0.1		      & (1, ${\infty}$) \\ \cline{1-1}
	       \textit{Termination} $\alpha$	  & 		      & \\ \hline
	       \textit{Bifurcation} $\beta$	  & 3		      & (1, ${\infty}$) \\ \cline{1-1}
	       \textit{Termination} $\beta$	  & 		      & \\ \hline
	       Ka \textit{Stem conductance}	  & 0.001	      & [0, 0.22] \\ \cline{1-1}
	       Ka \textit{peak}			  &      	      & \\ \hline
	       CaT \textit{Stem conductance}	  & 0.05$\cdot10^{-5}$ & [0, 0.0022] \\ \cline{1-1}
	       CaT \textit{peak}		  &                   & \\ \hline
	       Ka \textit{taper rate}		  & 0.1		      & ($-{\infty}$, ${\infty}$) \\ \cline{1-1}
	       CaT \textit{taper rate}		  &     	      & \\ \hline
	       Ka \textit{Gausian} $\mu$	  & 0.05	      & [0, 1] \\ \cline{1-1}
	       CaT \textit{Gausian} $\mu$	  & 	              & \\ \hline
	       Ka \textit{Gausian} $\sigma$	  & 0.05	      & (0, ${\infty}$)\\ \cline{1-1}
	       CaT \textit{Gausian} $\sigma$	  &     	      & \\ \hline
	     \end{tabular}					     
	   \end{center}						     
         \end{table}
     \end{itemize}

     %% \begin{table}[H]
       %%   \caption{遺伝アルゴリズムパラメータ}
       %%   \label{GA-parameter}
       %%   \begin{center}
       %%     \begin{tabular}[H]{|c|l|l|c|} \hline
       %%       \multicolumn{1}{|c}{No.} & \multicolumn{1}{|c}{パラメータ名} & \multicolumn{1}{|c|}{説明} & \multicolumn{1}{c|}{値域}\\ \hline \hline
       %%     \end{tabular}
       %%   \end{center}
       %% \end{table}

 \section{実験手順}
   以上の方法を用いて行った実験の設定について詳述する. 
   \subsection{実験における独立変数}
     本実験で操作する独立変数について説明する. 独立変数はKa, CaTイオンチャネルの有無,
     2種類のシナプスを活性化させる時間差${\Delta}t$, 樹状突起上のコンダクタンス分布様式
     である. それぞれの変数の組に対して上記の遺伝アルゴリズムを用い, 最適な$Neuron$を求めた.
     また, いずれの試行においても試行数は10回とした. 
     \begin{enumerate}
       \item \textbf{Ka, CaTイオンチャネルの有無} \\
         本実験では神経細胞のイオンチャネルとしてKaチャネル, CaTチャネルを用いるが,
         それぞれを用いるパターンと用いないパターンを用意した. よってパターンとしては
         表\ref{ion-channel_pattern}の4つがある. 両方のイオンチャネルを使用しないパターン
         をPassiveと呼ぶ. なお, チャネルを用いないパターン
         とは, そのイオンチャネルの最大コンダクタンス量$\overline{g}$
         をすべてのコンパートメントにおいて常に$\overline{g} = 0$としておくことである. 
         \begin{table}[h]
           \caption{樹状突起上のイオンチャネルのパターン}
           \label{ion-channel_pattern}
           \begin{center}
             \begin{tabular}[h]{|c||c|} \hline
               No. & イオンチャネル \\ \hline \hline
               1 & なし(Passive) \\ \hline
               2 & Ka \\ \hline
               3 & CaT \\ \hline
               4 & Ka, CaT \\ \hline
             \end{tabular}
           \end{center}
         \end{table}

       \item \textbf{${\Delta}t$のパターン} \\
         ${\Delta}t$は5[ms]から30[ms]まで5[ms]刻みにした. よって使用した値は
         表\ref{Delta_t_pattern}の6通りである.
         \begin{table}[H]
           \caption{${\Delta}t$のパターン}
           \label{Delta_t_pattern}
           \begin{center}
             \begin{tabular}[h]{|c||c|} \hline
               No. & ${\Delta}t$[ms] \\ \hline \hline
               1 & 5 \\ \hline
               2 & 10 \\ \hline
               3 & 15 \\ \hline
               4 & 20 \\ \hline
               5 & 25 \\ \hline
               6 & 30 \\ \hline
             \end{tabular}
           \end{center}
         \end{table}
         
       \item \textbf{コンダクタンス分布様式のパターン} \\ % <- コンダクタンスと言ったりチャネルと言ったり
         樹状突起上のコンダクタンス分布様式は表\ref{conductance_pattern}に示すように
         線形分布かガウス分布のどちらかを用いた.
         \begin{table}[H]
           \caption{コンダクタンス分布様式のパターン}
           \label{conductance_pattern}
           \begin{center}
             \begin{tabular}[h]{|c||c|} \hline
               No. & コンダクタンス分布様式 \\ \hline \hline
               1 & 線形分布 \\ \hline
               2 & ガウス分布 \\ \hline
             \end{tabular}
           \end{center}
         \end{table}
     \end{enumerate}
     
     %
     % やっぱり解析項目として, どういう携帯量を解析したのかは説明しておいたほうがいい
     %
     
